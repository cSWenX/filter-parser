# 项目结构设计

## 项目概述
图片滤镜参数反向分析软件 - 用户上传带滤镜效果的图片，自动反向解析滤镜参数，支持参数保存、历史管理和滤镜生成功能。

## 整体技术架构
- **前端**: React.js + TypeScript + Tailwind CSS
- **后端**: Python Flask + OpenCV/PIL 图像处理
- **存储**: 本地 localStorage (历史参数) + 临时文件存储
- **部署**: 前后端分离，支持本地部署

## 核心功能模块分布

### 前端模块 (React Components)
```
src/
├── components/
│   ├── ImageUpload/           # 图片上传组件
│   ├── ParameterAnalysis/     # 参数分析结果展示
│   ├── ParameterHistory/      # 历史参数管理
│   ├── FilterGenerator/       # 滤镜图片生成
│   └── UI/                    # 通用UI组件
├── services/
│   ├── api.ts                 # API调用服务
│   ├── storage.ts             # 本地存储服务
│   └── utils.ts               # 工具函数
└── hooks/
    ├── useImageAnalysis.ts    # 图片分析hook
    └── useParameterHistory.ts # 历史参数hook
```

### 后端模块 (Python Flask)
```
backend/
├── app.py                     # Flask主应用
├── routes/
│   ├── upload.py             # 图片上传路由
│   ├── analysis.py           # 参数分析路由
│   └── filter.py             # 滤镜生成路由
├── services/
│   ├── image_analyzer.py     # 图像参数分析核心
│   ├── filter_generator.py   # 滤镜生成核心
│   └── parameter_extractor.py # 参数提取算法
└── utils/
    ├── image_processing.py   # 图像处理工具
    └── validation.py         # 输入验证
```

## 技术栈详细规划

### 前端技术栈
- **框架**: React 18 + TypeScript
- **构建工具**: Vite (快速开发和构建)
- **样式**: Tailwind CSS + Headless UI
- **状态管理**: Zustand (轻量级状态管理)
- **HTTP客户端**: Axios
- **文件处理**: react-dropzone
- **图标**: Lucide React
- **通知**: react-hot-toast

### 后端技术栈
- **框架**: Flask + Flask-CORS
- **图像处理**:
  - OpenCV (cv2) - 主要图像分析
  - Pillow (PIL) - 图像格式处理
  - NumPy - 数值计算
- **文件处理**: Werkzeug
- **配置管理**: python-dotenv
- **API文档**: Flask-RESTX (可选)

### 开发工具
- **代码质量**: ESLint + Prettier (前端), Black + Flake8 (后端)
- **类型检查**: TypeScript (前端), mypy (后端)
- **测试**: Jest + React Testing Library (前端), pytest (后端)

## 完整项目目录结构

```
Filter-Parser/
├── README.md
├── package.json                   # 项目依赖管理
├── .gitignore
├── docker-compose.yml            # 容器化部署配置
│
├── frontend/                      # 前端React应用
│   ├── public/
│   │   ├── index.html
│   │   └── favicon.ico
│   ├── src/
│   │   ├── components/
│   │   │   ├── ImageUpload/
│   │   │   │   ├── ImageUpload.tsx
│   │   │   │   ├── DropZone.tsx
│   │   │   │   └── ImagePreview.tsx
│   │   │   ├── ParameterAnalysis/
│   │   │   │   ├── AnalysisResult.tsx
│   │   │   │   ├── ParameterCard.tsx
│   │   │   │   └── ExportOptions.tsx
│   │   │   ├── ParameterHistory/
│   │   │   │   ├── HistoryList.tsx
│   │   │   │   ├── HistoryItem.tsx
│   │   │   │   └── SaveParameterModal.tsx
│   │   │   ├── FilterGenerator/
│   │   │   │   ├── FilterPreview.tsx
│   │   │   │   ├── BeforeAfterComparison.tsx
│   │   │   │   └── DownloadButton.tsx
│   │   │   └── UI/
│   │   │       ├── Button.tsx
│   │   │       ├── Modal.tsx
│   │   │       ├── Loading.tsx
│   │   │       └── Toast.tsx
│   │   ├── hooks/
│   │   │   ├── useImageAnalysis.ts
│   │   │   ├── useParameterHistory.ts
│   │   │   ├── useFilterGenerator.ts
│   │   │   └── useLocalStorage.ts
│   │   ├── services/
│   │   │   ├── api.ts
│   │   │   ├── storage.ts
│   │   │   ├── encryption.ts
│   │   │   └── utils.ts
│   │   ├── types/
│   │   │   ├── parameter.ts
│   │   │   ├── image.ts
│   │   │   └── api.ts
│   │   ├── store/
│   │   │   └── useAppStore.ts
│   │   ├── App.tsx
│   │   ├── main.tsx
│   │   └── index.css
│   ├── package.json
│   ├── tsconfig.json
│   ├── vite.config.ts
│   └── tailwind.config.js
│
├── backend/                       # 后端Flask应用
│   ├── app.py                     # Flask主应用入口
│   ├── config.py                  # 配置文件
│   ├── requirements.txt           # Python依赖
│   ├── routes/
│   │   ├── __init__.py
│   │   ├── upload.py             # 图片上传路由
│   │   ├── analysis.py           # 参数分析路由
│   │   └── filter.py             # 滤镜生成路由
│   ├── services/
│   │   ├── __init__.py
│   │   ├── image_analyzer.py     # 核心图像参数分析
│   │   ├── filter_generator.py   # 滤镜生成服务
│   │   └── parameter_extractor.py # 参数提取算法
│   ├── utils/
│   │   ├── __init__.py
│   │   ├── image_processing.py   # 图像处理工具
│   │   ├── validation.py         # 输入验证
│   │   ├── file_manager.py       # 文件管理
│   │   └── constants.py          # 常量定义
│   ├── models/
│   │   ├── __init__.py
│   │   ├── parameter.py          # 参数数据模型
│   │   └── response.py           # 响应数据模型
│   └── tests/
│       ├── __init__.py
│       ├── test_analysis.py
│       ├── test_filter.py
│       └── test_utils.py
│
├── uploads/                       # 临时上传目录
├── output/                        # 生成图片输出目录
└── docs/                         # 项目文档
    ├── API.md                    # API文档
    ├── DEPLOYMENT.md             # 部署说明
    └── DEVELOPMENT.md            # 开发指南
```

## 关键算法模块

### 参数分析算法 (`image_analyzer.py`)
- 亮度分析: 基于RGB平均值计算
- 对比度分析: 灰度直方图标准差
- 饱和度分析: HSV色彩空间S通道
- 锐化分析: Sobel边缘检测强度
- 色温分析: RGB通道比值计算
- 色调分析: HSV色彩空间H通道
- 阴影/高光: 像素亮度分布分析

### 滤镜生成算法 (`filter_generator.py`)
- 基于参数值对图像进行像素级调整
- 支持批量参数应用
- 保持原图分辨率和质量

## 数据流设计

```
用户上传图片 → 前端预览 → 后端分析 → 返回参数 → 前端展示
     ↓
用户保存参数 → localStorage存储 → 历史参数列表
     ↓
用户选择历史参数 + 新图片 → 后端生成滤镜 → 返回处理后图片
```

## 性能优化策略

- **图片压缩**: 上传时自动压缩大图片
- **缓存机制**: 参数分析结果临时缓存
- **异步处理**: 图片处理采用异步队列
- **内存管理**: 处理完成后及时释放图片内存

## 安全性设计

- **文件验证**: 严格的图片格式验证
- **临时存储**: 24小时自动清理机制
- **参数加密**: localStorage中的历史参数加密存储
- **CORS配置**: 限制跨域访问

## 核心文件功能说明

**前端核心文件**:
- `App.tsx`: 主应用组件，布局和路由
- `useImageAnalysis.ts`: 图片分析状态管理
- `api.ts`: 统一API调用服务
- `storage.ts`: 本地存储和加密服务

**后端核心文件**:
- `app.py`: Flask应用初始化和路由注册
- `image_analyzer.py`: 8类参数分析算法实现
- `filter_generator.py`: 基于参数生成滤镜图片
- `file_manager.py`: 24小时自动清理机制

## 关键特性

- **用户体验**: ≤3秒分析，≤2秒生成，直观的拖拽上传
- **数据管理**: 本地存储历史参数，支持50条记录
- **功能完整**: 分析→保存→应用→下载的完整闭环
- **兼容性**: 支持主流浏览器和操作系统
- **可扩展**: 模块化设计，便于后续功能扩展

---
*注意：项目结构变动时需要同步更新此文档*